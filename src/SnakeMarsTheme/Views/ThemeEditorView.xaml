<UserControl x:Class="SnakeMarsTheme.Views.ThemeEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SnakeMarsTheme.ViewModels">

    <UserControl.DataContext>
        <vm:ThemeEditorViewModel/>
    </UserControl.DataContext>

    <Grid Margin="15">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="350"/>
        </Grid.ColumnDefinitions>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- LEFT PANEL: Widget Library -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Column="0" Background="{StaticResource BackgroundMediumBrush}" 
                CornerRadius="8" Margin="0,0,10,0">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title -->
                <TextBlock Grid.Row="0" Text="ðŸ“¦ Biblioteca de Widgets" 
                           FontSize="18" FontWeight="Bold"
                           Foreground="{StaticResource AccentCyanBrush}" 
                           Margin="0,0,0,15"/>

                <!-- Category Label -->
                <TextBlock Grid.Row="1" Text="CategorÃ­a:" 
                           FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,0,8"/>

                <!-- Category Selector -->
                <ComboBox Grid.Row="2" 
                          ItemsSource="{Binding Categories}" 
                          SelectedItem="{Binding SelectedCategory}"
                          FontSize="14" Padding="12,10"
                          Margin="0,0,0,15"/>

                <!-- Widget List -->
                <ListBox Grid.Row="3" 
                         ItemsSource="{Binding AvailableWidgets}"
                         SelectedItem="{Binding SelectedAvailableWidget}"
                         Background="{StaticResource BackgroundLightBrush}"
                         BorderThickness="0"
                         BorderBrush="{StaticResource BorderBrush}"
                         MouseDoubleClick="Widget_DoubleClick">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="8,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="30"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding Icon}" 
                                           FontSize="16" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                           FontSize="13"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Add Button -->
                <Button Grid.Row="4" Content="âž• AÃ±adir Widget" 
                        Style="{StaticResource SuccessButton}"
                        Command="{Binding AddWidgetCommand}"
                        FontSize="13"
                        Padding="15,12"
                        Margin="0,15,0,0"/>

                <!-- Templates Section Separator -->
                <Border Grid.Row="5" Height="1" Background="{StaticResource BorderBrush}" Margin="0,15"/>

                <!-- Templates Section -->
                <StackPanel Grid.Row="6">
                    <TextBlock Text="ðŸŽ¨ Plantillas Predefinidas" 
                               FontSize="14" FontWeight="Bold"
                               Foreground="{StaticResource AccentOrangeBrush}" 
                               Margin="0,0,0,10"/>
                    <ComboBox ItemsSource="{Binding AvailableTemplates}"
                              SelectedItem="{Binding SelectedTemplate}"
                              DisplayMemberPath="DisplayName"
                              FontSize="12" Padding="10,8"
                              Margin="0,0,0,10"/>
                    <Button Content="âš¡ Aplicar Plantilla"
                            Style="{StaticResource WarningButton}"
                            Command="{Binding ApplyTemplateCommand}"
                            FontSize="13"
                            Padding="12,10"/>
                    
                    <!-- Separator -->
                    <Border Height="1" Background="{StaticResource BorderBrush}" Margin="0,15"/>
                    
                    <!-- TEMA ACTUAL (moved from right panel) -->
                    <TextBlock Text="ðŸ“ TEMA ACTUAL" 
                               FontSize="14" FontWeight="Bold"
                               Foreground="{StaticResource AccentCyanBrush}" 
                               Margin="0,0,0,10"/>
                    <TextBlock Text="Nombre:" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Margin="0,0,0,3"/>
                    <TextBox Text="{Binding ThemeName, UpdateSourceTrigger=PropertyChanged}" 
                             FontSize="12" Padding="8,6" Margin="0,0,0,10"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                            <TextBlock Text="Ancho:" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                            <TextBox Text="{Binding ThemeWidth, UpdateSourceTrigger=PropertyChanged}" 
                                     FontSize="11" Padding="6,4"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="5,0,0,0">
                            <TextBlock Text="Alto:" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                            <TextBox Text="{Binding ThemeHeight, UpdateSourceTrigger=PropertyChanged}" 
                                     FontSize="11" Padding="6,4"/>
                        </StackPanel>
                    </Grid>
                    <TextBlock Text="{Binding PlacedWidgets.Count, StringFormat='{}{0} widgets'}" 
                               Foreground="{StaticResource AccentGreenBrush}"
                               FontSize="11" FontWeight="SemiBold" Margin="0,8,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- CENTER: Canvas Preview -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Column="1" Background="{StaticResource BackgroundDarkBrush}" 
                CornerRadius="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Canvas Header -->
                <Border Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" 
                        CornerRadius="8,8,0,0" Padding="20,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Project Controls -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <Button Content="Nuevo" Width="50" Height="28" 
                                    Command="{Binding NewProjectCommand}"
                                    ToolTip="Nuevo Proyecto" FontSize="11"/>
                            <Button Content="Abrir" Width="50" Height="28" 
                                    Command="{Binding LoadProjectCommand}"
                                    ToolTip="Abrir Proyecto (Ctrl+O)" FontSize="11" Margin="5,0,0,0"/>
                            <Button Content="Guardar" Width="60" Height="28" 
                                    Command="{Binding QuickSaveProjectCommand}"
                                    ToolTip="Guardar RÃ¡pido (Ctrl+S)" FontSize="11" Margin="5,0,0,0"/>
                            <TextBlock Text="{Binding ProjectStatus}" 
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       VerticalAlignment="Center" Margin="15,0,0,0" FontSize="12"/>
                        </StackPanel>

                        <!-- Title -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸŽ¨ Vista Previa" 
                                       Foreground="{StaticResource AccentCyanBrush}" 
                                       FontSize="16" FontWeight="Bold"/>
                        </StackPanel>

                        <!-- Info -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="{Binding CanvasResolution}" 
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       FontSize="14" FontWeight="SemiBold" Margin="0,0,20,0"/>
                            <TextBlock Text="{Binding ZoomLevel, StringFormat='Zoom: {0}%'}" 
                                       Foreground="{StaticResource AccentOrangeBrush}"
                                       FontSize="14"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Canvas Area -->
                <ScrollViewer Grid.Row="1" 
                              HorizontalScrollBarVisibility="Auto" 
                              VerticalScrollBarVisibility="Auto" 
                              Background="#0D0D0D"
                              Padding="20">
                    <Border HorizontalAlignment="Center" VerticalAlignment="Center" 
                            BorderBrush="{StaticResource AccentCyanBrush}" 
                            BorderThickness="2"
                            CornerRadius="4">
                        <Border.Effect>
                            <DropShadowEffect Color="#00FFFF" BlurRadius="15" Opacity="0.3"/>
                        </Border.Effect>
                        <Border.LayoutTransform>
                            <ScaleTransform ScaleX="{Binding ZoomScale}" ScaleY="{Binding ZoomScale}"/>
                        </Border.LayoutTransform>
                        <Canvas x:Name="ThemeCanvas" 
                                Width="{Binding ThemeWidth}" 
                                Height="{Binding ThemeHeight}"
                                Background="Black"
                                ClipToBounds="True"
                                MouseLeftButtonDown="Canvas_MouseDown"
                                MouseLeftButtonUp="Canvas_MouseUp"
                                MouseMove="Canvas_MouseMove"
                                AllowDrop="True">

                            <!-- Background Image (for static images) -->
                            <Image Source="{Binding BackgroundImage}" 
                                   Width="{Binding ThemeWidth}" 
                                   Height="{Binding ThemeHeight}"
                                   Stretch="Fill"
                                   Visibility="{Binding IsVideoBackground, Converter={StaticResource InverseBoolToVis}}"/>

                            <!-- Background Video (for mp4/avi/wmv) -->
                            <MediaElement x:Name="BackgroundVideo"
                                          Source="{Binding VideoSource}"
                                          Width="{Binding ThemeWidth}" 
                                          Height="{Binding ThemeHeight}"
                                          Stretch="Fill"
                                          LoadedBehavior="Manual"
                                          UnloadedBehavior="Stop"
                                          Loaded="BackgroundVideo_Loaded"
                                          MediaEnded="BackgroundVideo_MediaEnded"
                                          MediaFailed="BackgroundVideo_MediaFailed"
                                          Visibility="{Binding IsVideoBackground, Converter={StaticResource BoolToVis}}"/>

                            <!-- Widgets ItemsControl -->
                            <ItemsControl ItemsSource="{Binding PlacedWidgets}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                        <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- Outer border for selection highlight and mouse events -->
                                        <Border BorderBrush="{Binding BorderColor}" 
                                                BorderThickness="{Binding IsSelected, Converter={StaticResource BoolToBorderThickness}}"
                                                CornerRadius="3" 
                                                Background="Transparent"
                                                MouseLeftButtonDown="Widget_MouseDown"
                                                Cursor="SizeAll">
                                            <!-- Inner wrapper ensures hit-test works -->
                                            <Grid Background="Transparent" MinWidth="20" MinHeight="16">
                                                <!-- Text Widget -->
                                                <TextBlock Text="{Binding DisplayText}"
                                                           FontSize="{Binding FontSize}"
                                                           FontFamily="{Binding FontFamily}"
                                                           Foreground="{Binding ForegroundBrush}"
                                                           Padding="3"
                                                           Visibility="{Binding IsTextWidget, Converter={StaticResource BoolToVis}}"/>
                                                
                                                <!-- Bar Widget -->
                                                <Border Width="{Binding BarWidth}" 
                                                        Height="{Binding BarHeight}"
                                                        Background="{Binding BarBackground}"
                                                        CornerRadius="{Binding BarCornerRadius}"
                                                        Margin="3"
                                                        Visibility="{Binding IsBarWidget, Converter={StaticResource BoolToVis}}">
                                                    <Border Width="{Binding BarFillWidth}"
                                                            Height="{Binding BarHeight}"
                                                            Background="{Binding BarFillBrush}"
                                                            CornerRadius="{Binding BarCornerRadius}"
                                                            HorizontalAlignment="Left"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Canvas>
                    </Border>
                </ScrollViewer>

                <!-- Canvas Footer / Toolbar - REORGANIZED INTO 2 ROWS -->
                <Border Grid.Row="2" Background="{StaticResource BackgroundMediumBrush}" 
                        CornerRadius="0,0,8,8" Padding="15,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- ROW 1: Zoom, Undo/Redo, Snap Grid -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Zoom Controls -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Zoom:" Foreground="{StaticResource TextSecondaryBrush}" 
                                           VerticalAlignment="Center" Margin="0,0,8,0" FontSize="12"/>
                                <Button Content="âˆ’" Width="32" Height="28" 
                                        Command="{Binding ZoomOutCommand}" 
                                        FontSize="16" FontWeight="Bold"/>
                                <Button Content="100%" Width="50" Height="28" 
                                        Command="{Binding ZoomResetCommand}" 
                                        Margin="3,0" FontSize="11"/>
                                <Button Content="+" Width="32" Height="28" 
                                        Command="{Binding ZoomInCommand}"
                                        FontSize="16" FontWeight="Bold"/>
                            </StackPanel>

                            <!-- Undo/Redo -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0,0,0">
                                <Button Content="Undo" Width="45" Height="28" 
                                        Command="{Binding UndoCommand}"
                                        ToolTip="Deshacer (Ctrl+Z)" FontSize="11"/>
                                <Button Content="Redo" Width="45" Height="28" 
                                        Command="{Binding RedoCommand}"
                                        ToolTip="Rehacer (Ctrl+Y)" Margin="3,0,0,0" FontSize="11"/>
                                <TextBlock Text="{Binding UndoStatus}" 
                                           Foreground="{StaticResource TextSecondaryBrush}" 
                                           VerticalAlignment="Center" Margin="8,0,0,0" FontSize="10"/>
                            </StackPanel>

                            <!-- Snap to Grid -->
                            <Border Grid.Column="2" Background="{StaticResource BackgroundLightBrush}" 
                                    CornerRadius="4" Padding="8,4" Margin="20,0,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox Content="Snap Grid" 
                                              IsChecked="{Binding SnapToGrid}"
                                              VerticalAlignment="Center"
                                              Foreground="{StaticResource TextPrimaryBrush}"
                                              FontSize="11"/>
                                    <TextBox Text="{Binding GridSize, UpdateSourceTrigger=PropertyChanged}" 
                                             Width="30" Height="22" 
                                             FontSize="10" Padding="4,2" Margin="6,0,0,0"
                                             ToolTip="TamaÃ±o del grid"/>
                                    <TextBlock Text="px" 
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               VerticalAlignment="Center" Margin="3,0,0,0" FontSize="10"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- ROW 2: Action Buttons - Clean and Clear -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left: Canvas Actions -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <Button Content="Cargar Fondo" 
                                        Command="{Binding LoadBackgroundCommand}" 
                                        Padding="12,8" FontSize="11"/>
                                <Button Content="Limpiar" 
                                        Command="{Binding ClearCanvasCommand}"
                                        Margin="6,0,0,0" Padding="12,8" FontSize="11"/>
                            </StackPanel>

                            <!-- Right: Import/Export Actions -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <!-- .photo format -->
                                <Button Content="ðŸ“‚ Abrir .photo" 
                                        Command="{Binding ImportPhotoThemeCommand}" 
                                        Padding="12,8" FontSize="11"
                                        ToolTip="Importar tema .photo existente"/>
                                <Button Content="ðŸ“¦ Crear .photo" 
                                        Style="{StaticResource WarningButton}"
                                        Command="{Binding ExportToPhotoCommand}"
                                        Margin="8,0,0,0" Padding="12,8" FontSize="11"
                                        ToolTip="Exportar como .photo (7-Zip)"/>

                                <!-- .smtheme format -->
                                <Button Content="ðŸ“‚ Abrir .smtheme" 
                                        Command="{Binding ImportSmthemeCommand}"
                                        Margin="16,0,0,0" Padding="12,8" FontSize="11"
                                        ToolTip="Importar tema .smtheme"/>
                                <Button Content="ðŸ“¤ Crear .smtheme" 
                                        Style="{StaticResource PrimaryButton}"
                                        Command="{Binding ExportToSmthemeCommand}"
                                        Margin="8,0,0,0" Padding="12,8" FontSize="11"
                                        ToolTip="Exportar como .smtheme"/>

                                <!-- Main Save -->
                                <Button Content="ðŸ’¾ GUARDAR" 
                                        Style="{StaticResource SuccessButton}"
                                        Command="{Binding SaveThemeCommand}"
                                        Margin="16,0,0,0" Padding="18,8" FontSize="12"
                                        ToolTip="Guardar tema en carpeta"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- RIGHT PANEL: Properties -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Column="2" Background="{StaticResource BackgroundMediumBrush}" 
                CornerRadius="8" Margin="5,0,0,0">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Title -->
                <TextBlock Grid.Row="0" Text="âš™ï¸ Propiedades" 
                           FontSize="18" FontWeight="Bold"
                           Foreground="{StaticResource AccentCyanBrush}" 
                           Margin="0,0,0,15"/>

                <!-- Preview and Validation Panel -->
                <Expander Grid.Row="1" Header="ðŸ“„ Preview Setting.txt" 
                          IsExpanded="{Binding IsPreviewExpanded}"
                          Background="{StaticResource BackgroundLightBrush}"
                          Margin="0,0,0,15"
                          BorderBrush="{StaticResource AccentCyanBrush}"
                          BorderThickness="1">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" 
                                       FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource AccentOrangeBrush}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <StackPanel Margin="8">
                        <!-- Validation Errors List -->
                        <ItemsControl ItemsSource="{Binding ValidationErrors}" Margin="0,0,0,10">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource BackgroundDarkBrush}" 
                                            CornerRadius="4" Padding="6,4" Margin="0,0,0,3">
                                        <TextBlock FontSize="11" TextWrapping="Wrap" 
                                                   Text="{Binding Message}"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Setting.txt Preview -->
                        <TextBox Text="{Binding SettingPreviewText, Mode=OneWay}" 
                                 FontFamily="Consolas" FontSize="10"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 Background="{StaticResource BackgroundDarkBrush}"
                                 BorderBrush="{StaticResource BorderBrush}"
                                 IsReadOnly="True"
                                 TextWrapping="NoWrap"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Auto"
                                 Height="150"
                                 Margin="0,0,0,8"/>

                        <!-- Copy Button -->
                        <Button Content="ðŸ“‹ Copiar Setting.txt" 
                                Command="{Binding CopySettingToClipboardCommand}"
                                Background="{StaticResource AccentOrangeBrush}"
                                Foreground="#000000" 
                                FontSize="11" Padding="8,6"
                                HorizontalAlignment="Stretch"/>
                    </StackPanel>
                </Expander>

                <!-- Properties Panel -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Selected Widget Name -->
                        <Border Background="{StaticResource BackgroundLightBrush}" 
                                CornerRadius="6" Padding="12" Margin="0,0,0,20">
                            <TextBlock Text="{Binding SelectedWidget.Name, FallbackValue='Selecciona un widget'}" 
                                       Foreground="{StaticResource AccentGreenBrush}" 
                                       FontWeight="Bold" FontSize="15"
                                       TextWrapping="Wrap"/>
                        </Border>

                        <!-- Position Section -->
                        <TextBlock Text="POSICIÃ“N" 
                                   Foreground="{StaticResource AccentCyanBrush}" 
                                   FontSize="12" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="X" Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="11" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding SelectedWidget.X, UpdateSourceTrigger=PropertyChanged}" 
                                         FontSize="14" Padding="10,8"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Y" Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="11" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding SelectedWidget.Y, UpdateSourceTrigger=PropertyChanged}" 
                                         FontSize="14" Padding="10,8"/>
                            </StackPanel>
                        </Grid>

                        <StackPanel Margin="0,0,0,10">
                            <TextBlock Text="Z-Index" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding SelectedWidget.Z, UpdateSourceTrigger=PropertyChanged}" 
                                         FontSize="14" Padding="10,8"/>
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">
                                    <Button Content="â¬†ï¸" Width="36" Height="36" 
                                            Command="{Binding BringForwardCommand}"
                                            ToolTip="Subir una capa"/>
                                    <Button Content="â¬‡ï¸" Width="36" Height="36" 
                                            Command="{Binding SendBackwardCommand}"
                                            ToolTip="Bajar una capa" Margin="5,0,0,0"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>

                        <!-- Order Z Buttons -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Content="ðŸ“¤ Al Frente" 
                                    Command="{Binding BringToFrontCommand}"
                                    ToolTip="Traer al frente (mÃ¡ximo Z)"
                                    Padding="8,8" FontSize="11"/>
                            <Button Grid.Column="1" Content="ðŸ“¥ Al Fondo" 
                                    Command="{Binding SendToBackCommand}"
                                    ToolTip="Enviar al fondo (mÃ­nimo Z)"
                                    Padding="8,8" FontSize="11" Margin="5,0,0,0"/>
                        </Grid>

                        <!-- Font Section (Text Widgets) -->
                        <StackPanel Visibility="{Binding SelectedWidget.IsTextWidget, Converter={StaticResource BoolToVis}, FallbackValue=Collapsed}">
                            <TextBlock Text="FUENTE" 
                                       Foreground="{StaticResource AccentCyanBrush}" 
                                       FontSize="12" FontWeight="Bold" Margin="0,0,0,10"/>

                            <TextBlock Text="Familia" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding AvailableFonts}" 
                                      SelectedItem="{Binding SelectedWidget.FontFamily}"
                                      FontSize="13" Padding="10,8" Margin="0,0,0,15"/>

                            <TextBlock Text="TamaÃ±o" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,0,0,5"/>
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <Slider Grid.Column="0" Minimum="8" Maximum="72" 
                                        Value="{Binding SelectedWidget.FontSize}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding SelectedWidget.FontSize, StringFormat='{}{0} px'}" 
                                           Foreground="{StaticResource AccentCyanBrush}"
                                           FontSize="14" FontWeight="Bold"
                                           HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>

                        <!-- Color Section -->
                        <TextBlock Text="COLOR" 
                                   Foreground="{StaticResource AccentCyanBrush}" 
                                   FontSize="12" FontWeight="Bold" Margin="0,0,0,10"/>
                        <ComboBox ItemsSource="{Binding AvailableColors}" 
                                  SelectedItem="{Binding SelectedWidget.Color}"
                                  FontSize="13" Padding="10,8" Margin="0,0,0,20">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Width="20" Height="20" CornerRadius="4" Margin="0,0,12,0"
                                                Background="{Binding}" BorderBrush="#444" BorderThickness="1"/>
                                        <TextBlock Text="{Binding}" FontSize="13" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <!-- Bar Properties -->
                        <StackPanel Visibility="{Binding SelectedWidget.IsBarWidget, Converter={StaticResource BoolToVis}, FallbackValue=Collapsed}">
                            <TextBlock Text="BARRA" 
                                       Foreground="{StaticResource AccentCyanBrush}" 
                                       FontSize="12" FontWeight="Bold" Margin="0,0,0,10"/>

                            <TextBlock Text="Ancho" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,0,0,5"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="50"/>
                                </Grid.ColumnDefinitions>
                                <Slider Grid.Column="0" Minimum="20" Maximum="400" 
                                        Value="{Binding SelectedWidget.BarWidth}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding SelectedWidget.BarWidth, StringFormat='{}{0}'}" 
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <TextBlock Text="Alto" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,0,0,5"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="50"/>
                                </Grid.ColumnDefinitions>
                                <Slider Grid.Column="0" Minimum="5" Maximum="50" 
                                        Value="{Binding SelectedWidget.BarHeight}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding SelectedWidget.BarHeight, StringFormat='{}{0}'}" 
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <TextBlock Text="Valor MÃ¡ximo" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding SelectedWidget.MaxNum, UpdateSourceTrigger=PropertyChanged}" 
                                     FontSize="14" Padding="10,8" Width="100" HorizontalAlignment="Left"
                                     Margin="0,0,0,20"/>
                        </StackPanel>

                        <!-- Widget Actions -->
                        <TextBlock Text="ACCIONES" 
                                   Foreground="{StaticResource AccentCyanBrush}" 
                                   FontSize="12" FontWeight="Bold" Margin="0,10,0,10"/>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Content="ðŸ“‹ Copiar" 
                                    Command="{Binding CopyWidgetCommand}"
                                    FontSize="12" Padding="10,8" Margin="0,0,5,0"
                                    ToolTip="Ctrl+C"/>
                            <Button Grid.Column="1" Content="ðŸ“„ Pegar" 
                                    Command="{Binding PasteWidgetCommand}"
                                    FontSize="12" Padding="10,8" Margin="5,0,0,0"
                                    ToolTip="Ctrl+V"/>
                        </Grid>

                        <Button Content="â§‰ Duplicar Widget" 
                                Command="{Binding DuplicateWidgetCommand}"
                                Background="{StaticResource AccentOrangeBrush}" 
                                Foreground="#000000"
                                FontSize="13" Padding="12,10"
                                Margin="0,0,0,10"
                                ToolTip="Ctrl+D"/>

                        <!-- Multi-selection info -->
                        <Border Background="{StaticResource BackgroundDarkBrush}" 
                                CornerRadius="4" Padding="8" Margin="0,0,0,10"
                                Visibility="{Binding HasMultipleSelection, Converter={StaticResource BoolToVis}}">
                            <StackPanel>
                                <TextBlock Text="{Binding SelectionInfo}" 
                                           Foreground="{StaticResource AccentCyanBrush}" 
                                           FontSize="11" FontWeight="Bold" Margin="0,0,0,8"/>

                                <!-- Alignment Buttons -->
                                <TextBlock Text="Alinear:" Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="10" Margin="0,0,0,5"/>
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Content="â¬…" 
                                            Command="{Binding AlignSelectedLeftCommand}"
                                            ToolTip="Alinear izquierda" FontSize="12" Padding="4"/>
                                    <Button Grid.Column="1" Content="â¬†" 
                                            Command="{Binding AlignSelectedTopCommand}"
                                            ToolTip="Alinear arriba" FontSize="12" Padding="4" Margin="2,0"/>
                                    <Button Grid.Column="2" Content="â¬‡" 
                                            Command="{Binding AlignSelectedBottomCommand}"
                                            ToolTip="Alinear abajo" FontSize="12" Padding="4" Margin="2,0"/>
                                    <Button Grid.Column="3" Content="âž¡" 
                                            Command="{Binding AlignSelectedRightCommand}"
                                            ToolTip="Alinear derecha" FontSize="12" Padding="4"/>
                                </Grid>

                                <!-- Distribute Buttons -->
                                <TextBlock Text="Distribuir:" Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="10" Margin="0,5,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Button Grid.Column="0" Content="â†” Horizontal" 
                                            Command="{Binding DistributeHorizontallyCommand}"
                                            FontSize="10" Padding="6,4" Margin="0,0,2,0"/>
                                    <Button Grid.Column="1" Content="â†• Vertical" 
                                            Command="{Binding DistributeVerticallyCommand}"
                                            FontSize="10" Padding="6,4" Margin="2,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Delete Button -->
                        <Button Content="ðŸ—‘ï¸ Eliminar SelecciÃ³n" 
                                Command="{Binding DeleteSelectedCommand}"
                                Background="{StaticResource AccentRedBrush}" 
                                Foreground="#FFFFFF"
                                FontSize="14" Padding="15,12"
                                Margin="0,0,0,0"
                                ToolTip="Delete"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
